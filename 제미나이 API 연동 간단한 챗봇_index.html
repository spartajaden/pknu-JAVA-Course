<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê°„ë‹¨í•œ ì±—ë´‡</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .chat-container {
      width: 100%;
      max-width: 500px;
      height: 600px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .chat-header h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .chat-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #f8f9fa;
    }

    .message {
      margin-bottom: 15px;
      display: flex;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.bot {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 18px;
      word-wrap: break-word;
      line-height: 1.4;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.bot .message-content {
      background: white;
      color: #333;
      border: 1px solid #e0e0e0;
      border-bottom-left-radius: 4px;
    }

    .chat-input-area {
      padding: 20px;
      background: white;
      border-top: 1px solid #e0e0e0;
      display: flex;
      gap: 10px;
    }

    #user-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
    }

    #user-input:focus {
      border-color: #667eea;
    }

    #send-button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #send-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    #send-button:active {
      transform: translateY(0);
    }

    .typing-indicator {
      display: inline-flex;
      gap: 4px;
      padding: 8px 12px;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: #999;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.7;
      }
      30% {
        transform: translateY(-10px);
        opacity: 1;
      }
    }

    .quick-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 10px 20px;
      background: white;
      border-top: 1px solid #e0e0e0;
    }

    .quick-button {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 1px solid #e0e0e0;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
    }

    .quick-button:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    #send-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #user-input:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h1>ğŸ¤– ê°„ë‹¨í•œ ì±—ë´‡</h1>
      <p>ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</p>
    </div>

    <div class="chat-messages" id="chat-messages">
      <div class="message bot">
        <div class="message-content">
          ì•ˆë…•í•˜ì„¸ìš”! ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š
        </div>
      </div>
    </div>

    <div class="quick-buttons">
      <button class="quick-button" onclick="sendQuickMessage('ì•ˆë…•')">ì•ˆë…•</button>
      <button class="quick-button" onclick="sendQuickMessage('ì´ë¦„ì´ ë­ì•¼?')">ì´ë¦„ì´ ë­ì•¼?</button>
      <button class="quick-button" onclick="sendQuickMessage('ë„ì™€ì¤˜')">ë„ì™€ì¤˜</button>
      <button class="quick-button" onclick="sendQuickMessage('ê³ ë§ˆì›Œ')">ê³ ë§ˆì›Œ</button>
      <button class="quick-button" onclick="sendQuickMessage('ì˜ê°€')">ì˜ê°€</button>
    </div>

    <div class="chat-input-area">
      <input 
        type="text" 
        id="user-input" 
        placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
        onkeypress="handleKeyPress(event)"
      >
      <button id="send-button" onclick="sendMessage()">ì „ì†¡</button>
    </div>
  </div>

  <script>
    // ì±—ë´‡ ì‘ë‹µ ê·œì¹™ ì •ì˜
    const botResponses = {
      // ì¸ì‚¬ ê´€ë ¨
      'ì•ˆë…•': 'ë°˜ê°‘ìŠµë‹ˆë‹¤! ğŸ˜Š',
      'ì•ˆë…•í•˜ì„¸ìš”': 'ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
      'í•˜ì´': 'í•˜ì´! ë°˜ê°€ì›Œìš”! ğŸ‘‹',
      'í—¬ë¡œ': 'í—¬ë¡œ! ì•ˆë…•í•˜ì„¸ìš”!',
      'êµ¿ëª¨ë‹': 'ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”! â˜€ï¸',
      'êµ¿ë‚˜ì‡': 'ì¢‹ì€ ë°¤ ë˜ì„¸ìš”! ğŸŒ™',
      'ì˜ê°€': 'ì•ˆë…•íˆ ê°€ì„¸ìš”! ë˜ ë§Œë‚˜ìš”! ğŸ‘‹',
      'ì˜ì': 'ì•ˆë…•íˆ ì£¼ë¬´ì„¸ìš”! ì¢‹ì€ ê¿ˆ ê¾¸ì„¸ìš”!',
      'ë˜ë´': 'ë„¤, ë˜ ë§Œë‚˜ìš”! ğŸ˜Š',
      
      // ì´ë¦„ ê´€ë ¨
      'ì´ë¦„ì´ ë­ì•¼': 'ì €ëŠ” ì±—ë´‡ì´ì—ìš”! ì´ë¦„ì€ ì•„ì§ ì—†ë„¤ìš”. ğŸ˜…',
      'ì´ë¦„ì´ ë­ì•¼?': 'ì €ëŠ” ì±—ë´‡ì´ì—ìš”! ì´ë¦„ì€ ì•„ì§ ì—†ë„¤ìš”. ğŸ˜…',
      'ë„ˆ ì´ë¦„': 'ì €ëŠ” ì±—ë´‡ì´ì—ìš”!',
      'ë„ˆ ëˆ„êµ¬': 'ì €ëŠ” ì—¬ëŸ¬ë¶„ì„ ë„ì™€ì£¼ëŠ” ì±—ë´‡ì´ì—ìš”!',
      
      // ê°ì‚¬ ê´€ë ¨
      'ê³ ë§ˆì›Œ': 'ì²œë§Œì—ìš”! ë„ì›€ì´ ë˜ì–´ì„œ ê¸°ì©ë‹ˆë‹¤! ğŸ˜Š',
      'ê³ ë§ˆì›Œìš”': 'ì²œë§Œì—ìš”! ì–¸ì œë“ ì§€ ë¬¼ì–´ë³´ì„¸ìš”!',
      'ê°ì‚¬í•©ë‹ˆë‹¤': 'ë³„ë§ì”€ì„ìš”! ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“ ì§€ ë§ì”€í•´ì£¼ì„¸ìš”!',
      'ê°ì‚¬': 'ì²œë§Œì—ìš”! ğŸ˜Š',
      'ë•¡í': 'You\'re welcome! ğŸ˜Š',
      
      // ë„ì›€ ê´€ë ¨
      'ë„ì™€ì¤˜': 'ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ë§ì”€í•´ì£¼ì„¸ìš”!',
      'ë„ì™€ì£¼ì„¸ìš”': 'ë„¤, ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
      'ë„ì›€': 'ë¬´ì—‡ì´ í•„ìš”í•˜ì‹ ê°€ìš”?',
      'help': 'ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
      'í—¬í”„': 'ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
      
      // ê¸°íƒ€
      'ë­í•´': 'ì§€ê¸ˆ ì—¬ëŸ¬ë¶„ê³¼ ëŒ€í™”í•˜ê³  ìˆì–´ìš”! ğŸ˜Š',
      'ë­í•˜ë‹ˆ': 'ì§€ê¸ˆ ì—¬ëŸ¬ë¶„ê³¼ ëŒ€í™”í•˜ê³  ìˆì–´ìš”!',
      'ì¢‹ì•„': 'ì¢‹ì•„ìš”! ê¸°ì©ë‹ˆë‹¤! ğŸ˜Š',
      'ì¢‹ì•„ìš”': 'ì¢‹ì•„ìš”! ê¸°ì©ë‹ˆë‹¤!',
      'ì‹«ì–´': 'ì•„, ê·¸ë ‡êµ°ìš”. ë‹¤ë¥¸ ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.',
      'ê´œì°®ì•„': 'ë„¤, ì•Œê² ìŠµë‹ˆë‹¤!',
      'ì•Œê² ì–´': 'ë„¤, ì´í•´í–ˆìŠµë‹ˆë‹¤!',
      'ì•Œê² ìŠµë‹ˆë‹¤': 'ë„¤, ì´í•´í–ˆìŠµë‹ˆë‹¤!',
      
      // ë‚ ì”¨ ê´€ë ¨
      'ë‚ ì”¨': 'ì£„ì†¡í•´ìš”, ë‚ ì”¨ ì •ë³´ëŠ” ì œê³µí•˜ì§€ ëª»í•´ìš”. ë‚ ì”¨ ì•±ì„ í™•ì¸í•´ë³´ì„¸ìš”!',
      'ë‚ ì”¨ ì–´ë•Œ': 'ì£„ì†¡í•´ìš”, ë‚ ì”¨ ì •ë³´ëŠ” ì œê³µí•˜ì§€ ëª»í•´ìš”.',
      
      // ì‹œê°„ ê´€ë ¨
      'ëª‡ ì‹œì•¼': 'ì£„ì†¡í•´ìš”, ì‹œê°„ ì •ë³´ëŠ” ì œê³µí•˜ì§€ ëª»í•´ìš”. ì‹œê³„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!',
      'ì§€ê¸ˆ ëª‡ ì‹œ': 'ì£„ì†¡í•´ìš”, ì‹œê°„ ì •ë³´ëŠ” ì œê³µí•˜ì§€ ëª»í•´ìš”.',
    };

    // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
    async function sendMessage() {
      const input = document.getElementById('user-input');
      const message = input.value.trim();
      
      if (!message) return;
      
      // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
      addMessage(message, 'user');
      input.value = '';
      
      // ì…ë ¥ ë¹„í™œì„±í™”
      input.disabled = true;
      document.getElementById('send-button').disabled = true;
      
      // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
      const typingId = showTypingIndicator();
      
      try {
        // ë¨¼ì € ê¸°ì¡´ ì‘ë‹µ í™•ì¸
        const localResponse = getBotResponse(message);
        
        // ê¸°ì¡´ ì‘ë‹µì´ ê¸°ë³¸ ì‘ë‹µì¸ì§€ í™•ì¸ (ê¸°ë³¸ ì‘ë‹µì´ë©´ Gemini í˜¸ì¶œ)
        const isDefaultResponse = checkIfDefaultResponse(localResponse, message);
        
        if (isDefaultResponse) {
          // ê¸°ì¡´ ì‘ë‹µì´ ì—†ìœ¼ë©´ Gemini API í˜¸ì¶œ
          removeTypingIndicator(typingId);
          const geminiTypingId = showTypingIndicator();
          
          try {
            const response = await fetch('/api/chat/gemini', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ message: message })
            });
            
            removeTypingIndicator(geminiTypingId);
            
            if (response.ok) {
              const data = await response.json();
              addMessage(data.response, 'bot');
            } else {
              const errorData = await response.json();
              addMessage('ì£„ì†¡í•©ë‹ˆë‹¤. AI ì‘ë‹µì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'bot');
            }
          } catch (error) {
            removeTypingIndicator(geminiTypingId);
            addMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'bot');
          }
        } else {
          // ê¸°ì¡´ ì‘ë‹µì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
          removeTypingIndicator(typingId);
          setTimeout(() => {
            addMessage(localResponse, 'bot');
          }, 500);
        }
      } catch (error) {
        removeTypingIndicator(typingId);
        addMessage('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'bot');
      } finally {
        // ì…ë ¥ ë‹¤ì‹œ í™œì„±í™”
        input.disabled = false;
        document.getElementById('send-button').disabled = false;
        input.focus();
      }
    }

    // ë¹ ë¥¸ ë©”ì‹œì§€ ì „ì†¡
    function sendQuickMessage(message) {
      document.getElementById('user-input').value = message;
      sendMessage();
    }

    // Enter í‚¤ ì²˜ë¦¬
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    }

    // ê¸°ë³¸ ì‘ë‹µ ëª©ë¡
    const defaultResponses = [
      'ì£„ì†¡í•´ìš”, ì˜ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?',
      'ë¬´ì—‡ì„ ë§ì”€í•˜ì‹œëŠ” ê±´ì§€ ì˜ ëª¨ë¥´ê² ì–´ìš”. ë‹¤ë¥¸ í‘œí˜„ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”.',
      'ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ìœ„ì˜ ë¹ ë¥¸ ë²„íŠ¼ì„ ì‚¬ìš©í•´ë³´ì‹œê² ì–´ìš”?',
      'ì£„ì†¡í•©ë‹ˆë‹¤. ë” ëª…í™•í•˜ê²Œ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?'
    ];

    // ì±—ë´‡ ì‘ë‹µ ìƒì„± (ê¸°ì¡´ ê·œì¹™ ê¸°ë°˜)
    function getBotResponse(userMessage) {
      const message = userMessage.toLowerCase().trim();
      
      // ì •í™•í•œ í‚¤ì›Œë“œ ë§¤ì¹­
      if (botResponses[message]) {
        return botResponses[message];
      }
      
      // ë¶€ë¶„ ë§¤ì¹­ (í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš°)
      for (const [keyword, response] of Object.entries(botResponses)) {
        if (message.includes(keyword)) {
          return response;
        }
      }
      
      // ê¸°ë³¸ ì‘ë‹µ ë°˜í™˜ (ì´ ê²½ìš° Geminiê°€ í˜¸ì¶œë¨)
      return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
    }

    // ê¸°ë³¸ ì‘ë‹µì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
    function checkIfDefaultResponse(response, originalMessage) {
      // ê¸°ë³¸ ì‘ë‹µ ëª©ë¡ì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ true
      return defaultResponses.includes(response);
    }

    // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
    function showTypingIndicator() {
      const messagesContainer = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot';
      const typingId = 'typing-' + Date.now();
      messageDiv.id = typingId;
      
      messageDiv.innerHTML = `
        <div class="message-content">
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      `;
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return typingId;
    }

    // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œê±°
    function removeTypingIndicator(id) {
      const indicator = document.getElementById(id);
      if (indicator) {
        indicator.remove();
      }
    }

    // ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
    function addMessage(text, type) {
      const messagesContainer = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.textContent = text;
      
      messageDiv.appendChild(contentDiv);
      messagesContainer.appendChild(messageDiv);
      
      // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
    window.addEventListener('load', () => {
      document.getElementById('user-input').focus();
    });
  </script>
</body>
</html>
